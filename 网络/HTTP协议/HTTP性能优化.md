# HTTP性能优化

## 优化手段

前面三节中，总结了三个环节中，查看相关性能的方法。这三个环节中，传输链路可以采用CDN优化，客户端依赖于相应平台的技术，而服务器的优化主要采用三个手段：开源、节流、缓存。

## 开源

开源指的是采用高性能Web服务器，如Nginx和OpenResty。利用Nginx的反向代理能力实现动静分离，将动态请求反向代理到业务逻辑服务器(Java、Python)，静态资源请求由Nginx进行处理。

Nginx提供了很多可以进行调优的参数，如`keepalive`、`tcp fast open`、`reuseport`，减少握手延迟。

## 节流

节流指的是减少客户端和服务器间传输的数据量，在有限带宽中，传输更多的数据。主要的手段有三种：

- 压缩header
- 压缩body
- 减少请求次数

针对header，最常见的做法是，通过`domain`和`path`限制`Cookie`的使用。

针对body，主要手段是采用压缩算法，压缩传输的内容，如如采用`gzip`、`br`压缩算法。采用压缩算法时，需要选择合适的压缩比，过高的压缩比，会消耗大量计算资源。

针对不同的资源，需要选择不同的压缩手段：

- 文本：采用`gzip`、`br`即可。
- 图像、视频：这类资源已经被压缩，因此核心是剔除无效数据(如时间、地点)，适当降低分辨率，缩小尺寸，尽量选择高压缩率的格式。针对图片，可以JPEG(有损)和Webp(无损)格式。

针对请求次数，可以采用将小文件可以采用资源合并，将多个资源合并，减少请求次数。这里面还有一个方法可以使用，通过减少域名和重定向的使用，可以减少DNS解析时间。

## 缓存

通过在客户端本地、CDN和Web服务器中设置缓存，利用好缓存策略，尽量减少请求的次数和响应时间。

## 升级到HTTP/2

HTTP/2通过头部压缩减少了Header的尺寸、二进制帧和多路复用解决了应用层的队头阻塞问题，服务器推送减少了客户端的请求次数，大幅度提升了HTTP传输效率。升级到HTTP/2中需要取消HTTP/1中的一些优化手段，如资源合并、域名分片，让资源的粒度尽可能小，才能更好发挥缓存的作用。

